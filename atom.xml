<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Yuichi Takada]]></title>
  <link href="http://blog.takady.net/atom.xml" rel="self"/>
  <link href="http://blog.takady.net/"/>
  <updated>2017-03-24T23:19:29+09:00</updated>
  <id>http://blog.takady.net/</id>
  <author>
    <name><![CDATA[Yuichi Takada]]></name>
    <email><![CDATA[takadyuichi@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Huawei nova がきた]]></title>
    <link href="http://blog.takady.net/blog/2017/03/24/huawei-nova/"/>
    <updated>2017-03-24T22:38:13+09:00</updated>
    <id>http://blog.takady.net/blog/2017/03/24/huawei-nova</id>
    <content type="html"><![CDATA[<p>Nexus5 を使っていたけどそろそろバッテリーがヘタってきたし、<a href="http://blog.takady.net/blog/2016/05/15/nexus5-screen-replacement/">画面の交換</a>などで何度か解体したりして背面カバーのツメがいくつか折れてパカパカしていたので、色々調べて Huawei nova を買った。</p>

<p>NTT-X Store <a href="http://nttxstore.jp/">http://nttxstore.jp/</a> というオンラインストアで割引されていて、約33,000円だった。<br/>
Zenfone3 が良さそうだと思ってたんだけど、CPU や RAM が同じスペックの Huawei nova が割引されていたので買った。（Zenfone3 は台湾版を買えば安いらしいけど、技適適用にならないんじゃないかと思うので手を出さなかった）</p>

<p>Nexus5 は micro sim で nova は nano sim なので、ビックカメラに行って sim サイズ変更した。<br/>
sim サイズ変更キャンペーン中で変更手数料の2,000円は無料になって、即日発行手数料の 1,000円だけで済んだ。</p>

<h2>感想</h2>

<ul>
<li>パフォーマンスは Nexus5 に比べて良くなった。サクサク。</li>
<li>ディスプレイもきれい。</li>
<li>指紋認証は便利。かなり速い。</li>
<li>電池持ちがかなり良い。

<ul>
<li>100%充電済みで朝9時に出かけて、途中、普通に twitter、Line したり数時間podcastを聞いたりして23時時点で77%残ってる。動画見たりゲームしたりはしてない。</li>
</ul>
</li>
<li>デザインがなんか iPhone っぽさがある。</li>
<li>まだまともな保護ガラスフィルムが見つかってない。

<ul>
<li>今は Amazon で買ったやつを貼っているけど、普通にサイズが小さくてはみ出してる。</li>
</ul>
</li>
<li>USB Type-C になった。</li>
<li>付属のイヤホンに音量調節機能がある。

<ul>
<li>Nexus5ではイヤホンで音量調節できなかったので不便だった。付属のやつはボタンがやや押しにくいが。</li>
</ul>
</li>
<li>初期状態では UI が独自カスタマイズされているけど、ランチャーを Google now ランチャーに戻したら全然大丈夫になった。</li>
<li>5インチなので持ちやすい。</li>
<li>カメラは普通。Nexsu5よりは良い。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ruby の文字列マッチ判定のパフォーマンス]]></title>
    <link href="http://blog.takady.net/blog/2017/03/19/measure-performance-of-match-methods/"/>
    <updated>2017-03-19T17:36:07+09:00</updated>
    <id>http://blog.takady.net/blog/2017/03/19/measure-performance-of-match-methods</id>
    <content type="html"><![CDATA[<p>下記のようなよくある文字列のマッチ判定を Ruby でやる場合に、String クラスのメソッドを使った場合と正規表現を使った場合それぞれのベンチマーク結果を見てみた。</p>

<ul>
<li>部分文字列が含まれているか</li>
<li>指定の文字列で始まっているか</li>
<li>指定の文字列で終わっているか</li>
</ul>


<p>String のメソッドの方がパフォーマンスが良い。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ruby benchmarker.rb
</span><span class='line'>                           user     system      total        real
</span><span class='line'>[string]include        0.110000   0.000000   0.110000 (  0.116923)
</span><span class='line'>[regexp]include        0.230000   0.000000   0.230000 (  0.229775)
</span><span class='line'>[string]start_with     0.090000   0.010000   0.100000 (  0.087478)
</span><span class='line'>[regexp]start_with     0.230000   0.000000   0.230000 (  0.234467)
</span><span class='line'>[string]end_with       0.090000   0.000000   0.090000 (  0.091226)
</span><span class='line'>[regexp]end_with       0.250000   0.000000   0.250000 (  0.249781)</span></code></pre></td></tr></table></div></figure>


<p>コード。<br/>
生成コストが入らないように定数で宣言したものでベンチマーク取った。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">require</span> <span class="s1">&#39;benchmark&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">n</span> <span class="o">=</span> <span class="mi">1_000_000</span>
</span><span class='line'>
</span><span class='line'><span class="no">TEST</span> <span class="o">=</span> <span class="s1">&#39;test&#39;</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'><span class="no">TE</span> <span class="o">=</span> <span class="s1">&#39;te&#39;</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'><span class="no">ST</span> <span class="o">=</span> <span class="s1">&#39;st&#39;</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'><span class="no">REGEXP_TEST</span> <span class="o">=</span> <span class="sr">/test/</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'><span class="no">REGEXP_TE</span> <span class="o">=</span> <span class="sr">/\Ate/</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'><span class="no">REGEXP_ST</span> <span class="o">=</span> <span class="sr">/st\z/</span><span class="o">.</span><span class="n">freeze</span>
</span><span class='line'>
</span><span class='line'><span class="no">Benchmark</span><span class="o">.</span><span class="n">bm</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">b</span><span class="o">|</span>
</span><span class='line'>  <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;[string]include&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.n</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="no">TEST</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="no">TE</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;[regexp]include&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.n</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="no">REGEXP_TEST</span> <span class="o">===</span> <span class="no">TEST</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;[string]start_with&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.n</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="no">TEST</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="no">TE</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;[regexp]start_with&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.n</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="no">REGEXP_TE</span> <span class="o">===</span> <span class="no">TEST</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;[string]end_with&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.n</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="no">TEST</span><span class="o">.</span><span class="n">end_with?</span><span class="p">(</span><span class="no">ST</span><span class="p">)</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'>  <span class="n">b</span><span class="o">.</span><span class="n">report</span><span class="p">(</span><span class="s1">&#39;[regexp]end_with&#39;</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="mi">1</span><span class="o">.</span><span class="n">.n</span><span class="p">)</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="no">REGEXP_ST</span> <span class="o">===</span> <span class="no">TEST</span> <span class="p">}</span> <span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>ちなみに、<code>start_with?</code>、 <code>end_with?</code> は、引数に2つ以上文字列を指定できて、いずれかにマッチすれば true が返る。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">[</span><span class="mi">1</span><span class="o">]</span> <span class="n">pry</span><span class="p">(</span><span class="n">main</span><span class="p">)</span><span class="o">&gt;</span> <span class="s1">&#39;test&#39;</span><span class="o">.</span><span class="n">start_with?</span><span class="p">(</span><span class="s1">&#39;ab&#39;</span><span class="p">,</span> <span class="s1">&#39;te&#39;</span><span class="p">)</span>
</span><span class='line'><span class="o">=&gt;</span> <span class="kp">true</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Travis CI で mini_racer と mysql を使うビルドが失敗する]]></title>
    <link href="http://blog.takady.net/blog/2017/02/21/install-mini-racer-on-travis-ci/"/>
    <updated>2017-02-21T23:07:09+09:00</updated>
    <id>http://blog.takady.net/blog/2017/02/21/install-mini-racer-on-travis-ci</id>
    <content type="html"><![CDATA[<p>rails プロジェクトの CI に Travis CI を利用しているが、ある日 mini_racer を Gemfile に追加してビルドを試みたところ、bundle install で <code>Gem::Ext::BuildError: ERROR: Failed to build gem native extension.</code> なエラーが出てしまった。</p>

<p>Travis CI のデフォルトの環境では mini_racer が入らないってことのようで、<a href="https://github.com/discourse/mini_racer#travis-ci">mini_racer の README.md</a> には下記の対応方法が記載されている。</p>

<pre><code>sudo: required
dist: trusty
</code></pre>

<p>これで実際に、mini_racer は install 出来るようになる。</p>

<p>ただ、rails のプロジェクトの DB として mysql を使っていたため、新たに別の問題が発生する。<br/>
2017年2月の時点で、<a href="https://docs.travis-ci.com/user/trusty-ci-environment/#Data-Stores">Trusty の環境には mysql が入ってない</a>ので <code>rake db:migrate</code> あたりで DB に接続できませんということでビルドが失敗する。</p>

<p><a href="https://github.com/travis-ci/travis-ci/issues/6842#issuecomment-278601433">この辺の issue</a> など参考にしながら、ひとまず mysql を自分で入れるってことと、mysql の接続ユーザを <code>root</code> にする事で回避した。</p>

<pre><code>dist: trusty
sudo: required
addons:
  apt:
    packages:
    - mysql-server-5.6
    - mysql-client-core-5.6
    - mysql-client-5.6
</code></pre>

<p>きびしい。</p>

<h2>参考</h2>

<ul>
<li><a href="https://github.com/discourse/mini_racer#travis-ci">https://github.com/discourse/mini_racer#travis-ci</a></li>
<li><a href="https://github.com/travis-ci/travis-ci/issues/6842#issuecomment-278601433">&ldquo;Can&rsquo;t connect to local MySQL server through socket &lsquo;/var/run/mysqld/mysqld.sock&rsquo;&rdquo; · Issue #6842 · travis-ci/travis-ci</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails のログを fluentd で slack に通知する]]></title>
    <link href="http://blog.takady.net/blog/2017/02/19/fluentd-send-error-to-slack/"/>
    <updated>2017-02-19T18:58:24+09:00</updated>
    <id>http://blog.takady.net/blog/2017/02/19/fluentd-send-error-to-slack</id>
    <content type="html"><![CDATA[<p>Ubuntu に td-agent 入れて Slack に rails アプリのエラーを通知するようにしたときの備忘録。</p>

<h2>td-agent</h2>

<h3>インストール</h3>

<p>td-agent のインストールは下記に書いてある通り。<br/>
<a href="http://docs.fluentd.org/v0.12/articles/install-by-deb">Installing Fluentd Using deb Package | Fluentd</a></p>

<p>Ubuntu 16.04 なので下記で入れた。</p>

<pre><code>$ curl -L https://toolbelt.treasuredata.com/sh/install-ubuntu-xenial-td-agent2.sh | sh
</code></pre>

<h3>プラグインのインストール</h3>

<p>td-agent-gem で slack のプラグインをインストール。</p>

<pre><code>$ td-agent-gem install fluent-plugin-slack
</code></pre>

<h3>設定ファイルの修正</h3>

<p><code>/etc/td-agent/td-agent.conf</code> を下記のように修正。<br/>
webhook の URL あらかじめ Slack 取得しておく。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;source&gt;
</span><span class='line'>  @type forward
</span><span class='line'>&lt;/source&gt;
</span><span class='line'>
</span><span class='line'>&lt;match app.*&gt;
</span><span class='line'>  type copy
</span><span class='line'>  &lt;store&gt;
</span><span class='line'>    @type file
</span><span class='line'>    path /var/log/app/web
</span><span class='line'>    time_slice_wait 10m
</span><span class='line'>    compress gzip
</span><span class='line'>  &lt;/store&gt;
</span><span class='line'>
</span><span class='line'>  &lt;store&gt;
</span><span class='line'>    @type rewrite_tag_filter
</span><span class='line'>    rewriterule1 severity FATAL app.fatal
</span><span class='line'>  &lt;/store&gt;
</span><span class='line'>&lt;/match&gt;
</span><span class='line'>
</span><span class='line'>&lt;match app.fatal&gt;
</span><span class='line'>  @type slack
</span><span class='line'>  webhook_url https://hooks.slack.com/services/xxxxxxxxxxx
</span><span class='line'>  channel app_error
</span><span class='line'>  username ErrorBot
</span><span class='line'>  icon_emoji :astonished:
</span><span class='line'>  message_keys messages
</span><span class='line'>  flush_interval 5s
</span><span class='line'>&lt;/match&gt;
</span><span class='line'>
</span><span class='line'>&lt;match clear&gt;
</span><span class='line'>  @type null
</span><span class='line'>&lt;/match&gt;</span></code></pre></td></tr></table></div></figure>


<h3>再起動</h3>

<p>td-agent を再起動する。</p>

<pre><code>$ /etc/init.d/td-agent restart
</code></pre>

<h2>rails</h2>

<h3>Gemfile</h3>

<p><code>act-fluent-logger-rails</code> と <code>lograge</code> をインストール。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'act-fluent-logger-rails'
</span><span class='line'>gem 'lograge'</span></code></pre></td></tr></table></div></figure>


<h3>config/environments/production.rb</h3>

<p>loggerの設定。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">log_level</span> <span class="o">=</span> <span class="ss">:info</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="no">ActFluentLoggerRails</span><span class="o">::</span><span class="no">Logger</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">lograge</span><span class="o">.</span><span class="n">enabled</span> <span class="o">=</span> <span class="kp">true</span>
</span><span class='line'><span class="n">config</span><span class="o">.</span><span class="n">lograge</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="no">Lograge</span><span class="o">::</span><span class="no">Formatters</span><span class="o">::</span><span class="no">Json</span><span class="o">.</span><span class="n">new</span>
</span></code></pre></td></tr></table></div></figure>


<h3>config/fluent-logger.yml</h3>

<p>fluent用の設定ファイル。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">production</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">fluent_host</span><span class="p-Indicator">:</span>   <span class="s">&#39;127.0.0.1&#39;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">fluent_port</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">24224</span>
</span><span class='line'>  <span class="l-Scalar-Plain">tag</span><span class="p-Indicator">:</span>           <span class="s">&#39;app.web&#39;</span>
</span><span class='line'>  <span class="l-Scalar-Plain">messages_type</span><span class="p-Indicator">:</span> <span class="s">&#39;string&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>結果</h2>

<p>ログが下記に出るようになる。アプリケーションエラーが起きれば Slack にポストされる。</p>

<pre><code>$ tail -f /var/log/app/web.20170219.b548df17385a3a314
2017-02-19T09:51:42+00:00       app.web    {"messages":"{\"method\":\"GET\",\"path\":\"/\",\"format\":\"html\",\"controller\":\"FooController\",\"action\":\"index\",\"status\":200,\"duration\":1534.33,\"view\":1299.3,\"db\":0.0}","severity":"INFO"}
2017-02-19T09:51:43+00:00       app.web    {"messages":"{\"method\":\"GET\",\"path\":\"/api/foo.json\",\"format\":\"json\",\"controller\":\"Api::FooController\",\"action\":\"index\",\"status\":200,\"duration\":374.19,\"view\":49.21,\"db\":0.0}","severity":"INFO"}
</code></pre>

<h2>参考</h2>

<ul>
<li><a href="https://github.com/actindi/act-fluent-logger-rails">actindi/act-fluent-logger-rails: Fluent logger</a></li>
<li><a href="http://www.fluentd.org/datasources/rails">Collecting and Analyzing Ruby on Rails Logs | Fluentd</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Let's Encrypt と Nginx で HTTPS 対応]]></title>
    <link href="http://blog.takady.net/blog/2017/02/11/lets-encrypt-with-nginx/"/>
    <updated>2017-02-11T15:53:29+09:00</updated>
    <id>http://blog.takady.net/blog/2017/02/11/lets-encrypt-with-nginx</id>
    <content type="html"><![CDATA[<p>個人的に作ってるサイトを HTTPS 対応させてみた。<br/>
iptable ではまって2時間くらいかかってしまったけども、想像より手軽にできた。</p>

<h2>Let&rsquo;s Encrypt</h2>

<p><a href="https://letsencrypt.jp/">https://letsencrypt.jp/</a></p>

<p>無料で証明書を用意できるので今回利用した。</p>

<p>curl で実行ファイルを取ってきて、適切にオプションを付けて実行すると、対話形式にていくつかの確認に応え、証明書が作成される。<br/>
以下、実行例。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo certbot-auto certonly --webroot -w /path/to/app/current/public -d example.com --email your_email@example.com</span></code></pre></td></tr></table></div></figure>


<p>webroot に指定したパスの下にファイルが置かれ、そこに対してリクエストを送って確認しているみたいなので、アクセスできるようにしておく必要がある。</p>

<p>これで <code>/etc/letsencrypt/live/example.com/</code> 以下に、証明書や秘密鍵が配置されるので(実際にはこれはシンボリックリンクなのだが)、これらのファイルを Nginx の設定で指定する。</p>

<h2>iptables</h2>

<p><code>/etc/sysconfig/iptables</code> を見て、80 と同様に 443 も許可されている事を確認しておく。<br/>
されてない場合は追加することになるのだけど、このファイル直接編集は推奨されていないらしいので iptables コマンドで追加する。<br/>
<code>sudo /sbin/iptables -L</code> で設定を確認できる。最後に <code>iptables save</code> するのを忘れずに。<br/>
あとは iptables を再起動すると反映されるはず。</p>

<h2>Nginx</h2>

<p>実際の Nginx の設定は下記のようにした。<br/>
http のリクエストは https にリダイレクトさせるようにした。<br/>
（unicorn を使ってるのでその記述があるが今回の件には直接関係無い。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='nginx'><span class='line'><span class="k">upstream</span> <span class="s">unicorn</span> <span class="p">{</span>
</span><span class='line'>    <span class="kn">server</span> <span class="s">unix:/path/to/app/current/tmp/sockets/unicorn.sock</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">server</span> <span class="p">{</span>
</span><span class='line'>    <span class="kn">listen</span> <span class="mi">80</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">return</span> <span class="mi">301</span> <span class="s">https://</span><span class="nv">$host$request_uri</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="k">server</span> <span class="p">{</span>
</span><span class='line'>    <span class="kn">listen</span> <span class="mi">443</span> <span class="s">ssl</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">server_name</span> <span class="s">example.com</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kn">ssl</span> <span class="no">on</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">ssl_certificate</span> <span class="s">/etc/letsencrypt/live/example.com/fullchain.pem</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">ssl_certificate_key</span> <span class="s">/etc/letsencrypt/live/example.com/privkey.pem</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">ssl_protocols</span> <span class="s">TLSv1</span> <span class="s">TLSv1.1</span> <span class="s">TLSv1.2</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">ssl_prefer_server_ciphers</span> <span class="no">on</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">ssl_ciphers</span> <span class="s">&quot;EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH&quot;</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">access_log</span> <span class="s">/var/log/nginx/example.com.access.log</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">root</span> <span class="s">/path/to/app/current/public</span><span class="p">;</span>
</span><span class='line'>    <span class="kn">try_files</span> <span class="nv">$uri</span> <span class="s">@unicorn</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kn">location</span> <span class="p">~</span> <span class="sr">^/assets/</span> <span class="p">{</span>
</span><span class='line'>        <span class="kn">root</span> <span class="s">/path/to/app/shared/public</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kn">location</span> <span class="s">@unicorn</span> <span class="p">{</span>
</span><span class='line'>        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Host</span> <span class="nv">$host</span><span class="p">;</span>
</span><span class='line'>        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-Server</span> <span class="nv">$host</span><span class="p">;</span>
</span><span class='line'>        <span class="kn">proxy_set_header</span> <span class="s">X-Forwarded-For</span> <span class="nv">$proxy_add_x_forwarded_for</span><span class="p">;</span>
</span><span class='line'>        <span class="kn">proxy_pass</span> <span class="s">http://unicorn</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kn">location</span> <span class="s">/robots.txt</span> <span class="p">{</span>
</span><span class='line'>        <span class="kn">alias</span> <span class="s">/path/to/app/current/public/robots.txt</span><span class="p">;</span>
</span><span class='line'>    <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>SSL LABS</h2>

<p><a href="https://www.ssllabs.com/ssltest/">https://www.ssllabs.com/ssltest/</a></p>

<p>SSL の設定確認できるサイト。<br/>
以下のようになればうまくいっている。</p>

<p><img src="http://blog.takady.net/images/2017-02-11-lets-encrypt-with-nginx/screenshot.png" width="600" alt="" /></p>

<h2>参考</h2>

<ul>
<li><a href="https://programming.wikihub.io/@r7kamura/20160702202711">Let&rsquo;s EncryptとAmazon LinuxとNginxでamakan.netをHTTPSに対応させた - Programming</a></li>
<li><a href="http://nobuneko.com/blog/archives/2013/05/linux_centos_6_iptables_http_https.html">Linux(CentOS 6) - iptablesの設定を変更し、http、httpsでのアクセスを許可する - r_nobuホームページ</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2016年まとめ]]></title>
    <link href="http://blog.takady.net/blog/2016/12/31/2016-summary/"/>
    <updated>2016-12-31T13:10:16+09:00</updated>
    <id>http://blog.takady.net/blog/2016/12/31/2016-summary</id>
    <content type="html"><![CDATA[<p>自分用今年のまとめ。</p>

<h2>英語</h2>

<p>自分の中で英語をやる機運が高まってきたので勉強始めた。</p>

<ul>
<li>夏あたりからオンライン英会話を週1,2回ペースでやって、オンサイトの英会話に週1ペースで行ってる。

<ul>
<li>自然言語の習得は毎日継続するのが良いらしいので毎日やるような習慣にしたい。</li>
</ul>
</li>
<li>あとはamazonで買った<a href="https://www.amazon.co.jp/gp/product/0521734770/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=0521734770&amp;linkCode=as2&amp;tag=takadayuichi-22">英語圏の小学生用のテキスト</a>をやってる。</li>
</ul>


<h2>発表</h2>

<ul>
<li>7月の頭に1回だけ、その時会社でやってたログ収集の基盤とre:dashについて社外でLTした。

<ul>
<li>もっと発表していく予定だったけど、その後業務でやることが変わったりしてその余裕とかネタが取れなかった。</li>
</ul>
</li>
</ul>


<h2>業務</h2>

<ul>
<li>前半は去年の続きをやっていた感じだった。</li>
<li>後半は KPI 基盤のリプレースのプロジェクトのメインメンバーとして進めて、そのあと方針変更により別プロジェクトのメンバーになった。</li>
<li>12月には事業の開発チームに異動することとなった。

<ul>
<li>動きがあった方が学びは多いと思うが、やってる途中で止めないといけない事もあったりするのでそこの割り切りが必要になった。</li>
</ul>
</li>
</ul>


<h2>読書</h2>

<p>5月に Kindle Paperwhite 買ったらめっちゃ読書体験が良くなって以前より本が読みやすくなった。<br/>
会社の技術書購入支援制度があるのもあって、読む本には困らなかった。</p>

<ul>
<li><a href="https://www.amazon.co.jp/gp/product/4798121967/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4798121967&amp;linkCode=as2&amp;tag=takadayuichi-22">エリック・エヴァンスのドメイン駆動設計 (IT Architects’Archive ソフトウェア開発の実践) </a></li>
<li><a href="https://www.amazon.co.jp/gp/product/4797376279/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4797376279&amp;linkCode=as2&amp;tag=takadayuichi-22">10年戦えるデータ分析入門 SQLを武器にデータ活用時代を生き抜く (Informatics &amp;IDEA) </a></li>
<li><a href="https://www.amazon.co.jp/gp/product/4822284654/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4822284654&amp;linkCode=as2&amp;tag=takadayuichi-22">オブジェクト指向でなぜつくるのか 第2版</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B00I96CJWO/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00I96CJWO&amp;linkCode=as2&amp;tag=takadayuichi-22">ピープルウエア　第3版</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B01GDS0994/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B01GDS0994&amp;linkCode=as2&amp;tag=takadayuichi-22">SOFT SKILLS　ソフトウェア開発者の人生マニュアル</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B015DRJF8W/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B015DRJF8W&amp;linkCode=as2&amp;tag=takadayuichi-22">日本人の働き方の9割がヤバい件について</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B00HOTLXKQ/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B00HOTLXKQ&amp;linkCode=as2&amp;tag=takadayuichi-22">10年後の仕事のカタチ10のヒント</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/4860641345/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4860641345&amp;linkCode=as2&amp;tag=takadayuichi-22">どんどん話すための瞬間英作文トレーニング</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/4274217620/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4274217620&amp;linkCode=as2&amp;tag=takadayuichi-22">エクストリームプログラミング</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B01D2UKPFE/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B01D2UKPFE&amp;linkCode=as2&amp;tag=takadayuichi-22">Android実践プログラミング 現場で生まれた設計パターン</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/479813161X/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=479813161X&amp;linkCode=as2&amp;tag=takadayuichi-22">実践ドメイン駆動設計 (Object Oriented SELECTION) </a></li>
<li><a href="https://www.amazon.co.jp/gp/product/B01L8SEVYI/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B01L8SEVYI&amp;linkCode=as2&amp;tag=takadayuichi-22">オブジェクト指向設計実践ガイド ～Rubyでわかる 進化しつづける柔軟なアプリケーションの育て方</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/4873117437/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4873117437&amp;linkCode=as2&amp;tag=takadayuichi-22">メタプログラミングRuby 第2版</a></li>
<li><a href="https://leanpub.com/everydayrailsrspec-jp">Everyday Rails - RSpecによるRailsテスト入門</a></li>
<li><a href="https://www.amazon.co.jp/gp/product/4163902309/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4163902309&amp;linkCode=as2&amp;tag=takadayuichi-22">火花</a></li>
</ul>


<h2>isucon</h2>

<ul>
<li>今年も<a href="http://blog.takady.net/blog/2016/09/21/isucon6-qualifier/">予選落ち</a>した。来年こそなんとかしたい。</li>
<li>日頃から web アプリケーションに関する技術的な知見を積み重ねていきたい。</li>
</ul>


<h2>個人的な技術的興味</h2>

<ul>
<li>Android アプリ開発について勉強しようと思って、アプリを作ってみたりしてた。

<ul>
<li>軽くしかできてないのでもうちょっと深くやりたい。</li>
</ul>
</li>
<li>js というか React を触ってた。</li>
</ul>


<h2>その他</h2>

<ul>
<li>メインのエディタを sublime text から RubyMine に完全に移行した。</li>
<li>プライベートのメールクライアントを gmail から inbox に移行した。</li>
<li>シンガポール、オランダ、ドイツに旅行に行った。

<ul>
<li>楽しかったからまた海外旅行行きたい。</li>
</ul>
</li>
</ul>


<h2>まとめ</h2>

<p>年初にやってたこととかについては「これも今年だったか」と思うくらいに過去な感じがする。<br/>
来年の前半はアルゴリズムとデータ構造とかそういう基本的なところをちゃんと学び直したい。<br/>
あと英語が面白くなってきたから引き続きやっていこう。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails の validation error message の i18n 対応]]></title>
    <link href="http://blog.takady.net/blog/2016/12/09/rails-validation-error-message-i18n/"/>
    <updated>2016-12-09T21:20:43+09:00</updated>
    <id>http://blog.takady.net/blog/2016/12/09/rails-validation-error-message-i18n</id>
    <content type="html"><![CDATA[<p>rails で Custom validatior や Custom validation method を定義して、その中で <code>errors.add</code> する際に、
message として使われる I18n のパスをどう書くのが良いのかっていうのが気になった。<br/>
結論としては、下記のように書くのがスッキリして良さそう。</p>

<h2>Custom Validators</h2>

<p>特定のモデルによらないエラーメッセージの場合は、下記のように <code>locales/en.yml</code> を書くことで、<code>record.errors.add(attribute, :something_invalid)</code>と書ける。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">en</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">errors</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">messages</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">something_invalid</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Invalid something.</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MyCheckValidator</span> <span class="o">&lt;</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">EachValidator</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">validate_each</span><span class="p">(</span><span class="n">record</span><span class="p">,</span> <span class="n">attribute</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span class='line'>    <span class="k">unless</span> <span class="n">check_something</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>      <span class="n">record</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">attribute</span><span class="p">,</span> <span class="ss">:something_invalid</span><span class="p">)</span>
</span><span class='line'>      <span class="c1">#=&gt; record.errors.add(attribute, I18n.t(&#39;errors.messages.something_invalid&#39;)) と同じ</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">check_something</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span class='line'>   <span class="c1"># Something</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">MyModel</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">my_check</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Custom Methods</h2>

<p>特定のモデルの特定の項目のエラーメッセージの場合は、下記のようにymlを書くことで、適切にメッセージを参照してくれる。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">en</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">activerecord</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">errors</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">models</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">my_model</span><span class="p-Indicator">:</span>
</span><span class='line'>          <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">start_date</span><span class="p-Indicator">:</span>
</span><span class='line'>              <span class="l-Scalar-Plain">cannot_be_after_end_date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">It cannot be after the end date.</span>
</span><span class='line'>            <span class="l-Scalar-Plain">end_date</span><span class="p-Indicator">:</span>
</span><span class='line'>              <span class="l-Scalar-Plain">cannot_be_before_start_date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">It cannot be before the start date.</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">MyModel</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">validate</span> <span class="ss">:start_date_cannot_be_after_end_date</span><span class="p">,</span> <span class="k">if</span><span class="p">:</span> <span class="o">-&gt;</span> <span class="p">{</span> <span class="n">start_date</span><span class="o">.</span><span class="n">present?</span> <span class="o">&amp;&amp;</span> <span class="n">end_date</span><span class="o">.</span><span class="n">present?</span> <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">start_date_cannot_be_after_end_date</span>
</span><span class='line'>    <span class="k">return</span> <span class="k">if</span> <span class="n">start_date</span> <span class="o">&lt;=</span> <span class="n">end_date</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:start_date</span><span class="p">,</span> <span class="ss">:cannot_be_after_end_date</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">#=&gt; errors.add(:start_date, I18n.t(&#39;activerecord.errors.models.my_model.attributes.start_date.cannot_be_after_end_date&#39;)) と同じ</span>
</span><span class='line'>    <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:end_date</span><span class="p">,</span> <span class="ss">:cannot_be_before_start_date</span><span class="p">)</span>
</span><span class='line'>    <span class="c1">#=&gt; errors.add(:end_date, I18n.t(&#39;activerecord.errors.models.my_model.attributes.end_date.cannot_be_before_start_date&#39;)) と同じ</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h3>参考</h3>

<ul>
<li><a href="http://guides.rubyonrails.org/active_record_validations.html">Active Record Validations — Ruby on Rails Guides</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[isucon6 予選に参加した]]></title>
    <link href="http://blog.takady.net/blog/2016/09/21/isucon6-qualifier/"/>
    <updated>2016-09-21T20:11:54+09:00</updated>
    <id>http://blog.takady.net/blog/2016/09/21/isucon6-qualifier</id>
    <content type="html"><![CDATA[<p><a href="http://blog.takady.net/blog/2015/09/29/isucon5-qualifier/">去年</a>に引き続き、今年も同じメンバーで チームYashio として isucon6 予選に参加してきた。<br/>
今回は去年の経験を活かして予選通過できそうな気がしていたけど、またしても結果は惨敗で非常に残念。</p>

<h2>前日までの準備期間</h2>

<p>ちょうど1週間前あたりから、azure にアカウントを作って前回の予選の環境をデプロイして、
3人で色々な改修・実装を試してベンチマーカーを回したりして楽しんでた。<br/>
この一週間はとてもイイ感じで、N+1 を解消してみたり、DB のデータを redis にキャッシュしてみたり、3人で愚直にスコアを上げるのを楽しんでいて「なんかこれ今年は行けるんじゃない？！」みたいな雰囲気を感じてた。<br/>
あと、去年はサーバ上で直接コード修正するなどしてしまい、メンバーが並行して実装する事が非常に困難だった反省から、ローカルでの開発環境構築と deploy の仕組みの整備を @muratayusuke が確立してくれて、当日もおおいに役立った。</p>

<h2>当日</h2>

<p>今回はヒカリエの会場で参加。<br/>
朝は若干の緊張と期待感で、部活の試合の日の朝っぽい感じだった。</p>

<p><img src="http://blog.takady.net/images/2016-09-21-isucon6-qualifier/IMG_20160917_094840.jpg" width="600" alt="" /></p>

<p>10時に始まってからは、@muratayusuke が競技用のインスタンスの起動とか deploy 周りを整備したり、ruby 実装が起動するようにするなどした。<br/>
@tatsuyaoiw がコードを読んだりアプリケーションを触って理解を進めてた。<br/>
僕は、開発用として、マシンイメージを別の環境にデプロイしてインスタンスを起動して、そこの DB にローカルから接続できるように設定して、ローカルでアプリを動かすための設定をするなどした。<br/>
ローカル環境で開発して本番に deploy できる環境が整ったのがだいたい11時過ぎくらい。</p>

<p>ruby 実装での最初のスコアは 1100 くらいだったけど、スコア安定しなくて大体 0 だった気がする。<br/>
そこから @muratayusuke が nginx から static ファイル返してクライアントキャッシュ有効にしたり、 unicorn の worker 数増やしたりして 3000 くらいまで上げた。</p>

<p>stackprof の結果見てて、<code>#htmlify</code> がとにかく遅いって事で @tatsuyaoiw と話したりして、正規表現を使わない実装にチャレンジしてみた。<br/>
で、ここから何度か修正してはベンチマーカーを流して、「リンクがありません」エラーメッセージが出てそれを見て直してを繰り返して15時くらいまでひたすらやったんだけど、エラーが完全に取れなくて一人疲弊してきて、正規表現使わない実装は諦めて、keyword 一覧を redis から取ってきて、それを content に含まれてる keyword だけに限定して <code>gsub</code> に渡すっていう修正にとどまった。<br/>
これで 16,000 までは上がったけど、もはや上位陣との差が空いていて厳しい感じだった。</p>

<p>それから @tatsuyaoiw が user の情報を redis でキャッシュしたり isutar へのアクセス回数を減らしたり、@muratayusuke が nginx の設定変更とかもろもろやって 19,000 くらいが最高だった。</p>

<p><img src="http://blog.takady.net/images/2016-09-21-isucon6-qualifier/IMG_20160917_180855.jpg" width="600" alt="" /></p>

<h2>まとめ</h2>

<p>一つに時間掛け過ぎた。一時間くらいで諦めて他の方法とか箇所とかに切り替えた方が良かったと思う。<br/>
終わってから3人で飲みに行って悔しがった。<br/>
今回のお題は、スロークエリや N+1 みたいなものがほぼ無かったので、とにかく <code>#htmlify</code> をなんとかしないとーっていう感じだった。<br/>
そこでアルゴリズムの問題としてそれに向き合っていた時間が長すぎたんだけど、生成された html 自体をキャッシュするとかっていう方向でも良かったわけだし、そういう方針の切り替えができるような落ち着きの時間を持てると良さそう。<br/>
予選後に飲みながら話してた時に「そういう方法があったね」って話になったから、本番中に一旦落ち着いていればそれを思い付いて実行出来てたかもなーって思った。<br/>
来年こそは…！！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails で FormObject を使う]]></title>
    <link href="http://blog.takady.net/blog/2016/08/29/rails-form-object/"/>
    <updated>2016-08-29T19:38:49+09:00</updated>
    <id>http://blog.takady.net/blog/2016/08/29/rails-form-object</id>
    <content type="html"><![CDATA[<p>フォームでは日付の期間を入力し、それを日単位のレコードに保存するようなケースでは、FormObject を使えるかも。やってみた。</p>

<p><br /></p>

<p><img src="http://blog.takady.net/images/2016-08-29-rails-form-object/screenshot1.png" alt="" /></p>

<p>こういうフォーム。</p>

<h1>Model</h1>

<p>uniqueness など Model 単位でバリデーションしなければいけないものや、コンテキストに関係なくバリデーションするものは Model に書く。</p>

<h2>app/models/foo_day.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">FooDay</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">belongs_to</span> <span class="ss">:user</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:date</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">uniqueness</span><span class="p">:</span> <span class="p">{</span><span class="ss">scope</span><span class="p">:</span> <span class="ss">:user_id</span><span class="p">}</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>FormObject</h1>

<p>FormObject の参考では、よく <a href="https://github.com/solnic/virtus">virtus</a> を include しているサンプルがあるけど、Virtus の Type cast が効果的に使えそうなケース以外だと特に使わなくて良いかなと個人的に思った。<br/>
例えば今回のケースだと、view から文字列で渡ってくる <code>YYY-MM-DD</code> を Date に変換したかったので、一度 Virtus を使ってみたけど、
例えば <code>2016-08-32</code> のように Date として解釈できないものが渡ってきた場合に、エラーにならずに文字列のまま変数に格納される挙動だったので、あまり積極的に使う理由が無かった。<br/>
結局、日付の validation のために <a href="https://github.com/adzap/validates_timeliness">validates_timeliness</a> という gem を使ったけど便利だった。</p>

<h2>app/models/foo_day/registration_form.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">FooDay</span><span class="o">::</span><span class="no">RegistrationForm</span>
</span><span class='line'>  <span class="kp">include</span> <span class="no">ActiveModel</span><span class="o">::</span><span class="no">Model</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">attr_accessor</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">:from_date</span><span class="p">,</span> <span class="ss">:to_date</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:user_id</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:from_date</span><span class="p">,</span> <span class="ss">presence</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">timeliness</span><span class="p">:</span> <span class="p">{</span><span class="ss">on_or_after</span><span class="p">:</span> <span class="ss">:today</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:date</span><span class="p">}</span>
</span><span class='line'>  <span class="n">validates</span> <span class="ss">:to_date</span><span class="p">,</span> <span class="ss">allow_blank</span><span class="p">:</span> <span class="kp">true</span><span class="p">,</span> <span class="ss">timeliness</span><span class="p">:</span> <span class="p">{</span><span class="ss">on_or_after</span><span class="p">:</span> <span class="ss">:from_date</span><span class="p">,</span> <span class="ss">type</span><span class="p">:</span> <span class="ss">:date</span><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">save</span>
</span><span class='line'>    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="n">valid?</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">persist!</span>
</span><span class='line'>    <span class="kp">true</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="kp">private</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">foo_days</span>
</span><span class='line'>    <span class="vi">@foo_days</span> <span class="o">||=</span> <span class="n">build_foo_days</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">build_foo_days</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">to_date</span><span class="o">.</span><span class="n">blank?</span>
</span><span class='line'>      <span class="o">[</span><span class="no">FooDay</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">date</span><span class="p">:</span> <span class="n">from_date</span><span class="p">,</span> <span class="ss">user_id</span><span class="p">:</span> <span class="n">user_id</span><span class="p">)</span><span class="o">]</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="p">(</span><span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">from_date</span><span class="p">)</span><span class="o">.</span><span class="n">.</span><span class="no">Date</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">to_date</span><span class="p">))</span><span class="o">.</span><span class="n">map</span> <span class="p">{</span><span class="o">|</span><span class="n">date</span><span class="o">|</span> <span class="no">FooDay</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span> <span class="ss">date</span><span class="p">:</span> <span class="n">date</span><span class="p">)</span> <span class="p">}</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">valid?</span>
</span><span class='line'>    <span class="k">return</span> <span class="kp">false</span> <span class="k">unless</span> <span class="k">super</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">foo_days</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">foo_day</span><span class="o">|</span>
</span><span class='line'>      <span class="k">next</span> <span class="k">if</span> <span class="n">foo_day</span><span class="o">.</span><span class="n">valid?</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">foo_day</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">message</span><span class="o">|</span>
</span><span class='line'>        <span class="n">errors</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="ss">:base</span><span class="p">,</span> <span class="no">I18n</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="s1">&#39;activemodel.errors.invalid_foo_day&#39;</span><span class="p">,</span> <span class="ss">date</span><span class="p">:</span> <span class="n">foo_day</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="ss">message</span><span class="p">:</span> <span class="n">message</span><span class="p">))</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="k">super</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">persist!</span>
</span><span class='line'>    <span class="n">foo_days</span><span class="o">.</span><span class="n">each</span><span class="p">(</span><span class="o">&amp;</span><span class="ss">:save!</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Controller</h1>

<h2>app/controllers/foo_days_controller.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">FooDaysController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>    <span class="vi">@registration_form</span> <span class="o">=</span> <span class="no">FooDay</span><span class="o">::</span><span class="no">RegistrationForm</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>    <span class="vi">@registration_form</span> <span class="o">=</span> <span class="no">FooDay</span><span class="o">::</span><span class="no">RegistrationForm</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:foo_day_registration_form</span><span class="o">].</span><span class="n">merge</span><span class="p">(</span><span class="ss">user_id</span><span class="p">:</span> <span class="n">current_user</span><span class="o">.</span><span class="n">id</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="vi">@registration_form</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>      <span class="n">redirect_to</span> <span class="n">new_foo_day_path</span><span class="p">,</span> <span class="ss">notice</span><span class="p">:</span> <span class="s1">&#39;登録に成功しました&#39;</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>      <span class="n">flash</span><span class="o">.</span><span class="n">now</span><span class="o">[</span><span class="ss">:alert</span><span class="o">]</span> <span class="o">=</span> <span class="s1">&#39;登録に失敗しました&#39;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">render</span> <span class="ss">action</span><span class="p">:</span> <span class="ss">:new</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h1>View</h1>

<h2>app/views/foo_days/new.html.haml</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='haml'><span class='line'><span class="nc">.row</span>
</span><span class='line'>  <span class="nt">%h1</span> 日々の登録
</span><span class='line'>  <span class="p">=</span> <span class="n">form_for</span> <span class="vi">@registration_form</span><span class="p">,</span> <span class="ss">url</span><span class="p">:</span> <span class="n">foo_days_path</span><span class="p">,</span> <span class="nb">method</span><span class="p">:</span> <span class="ss">:post</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span>
</span><span class='line'>    <span class="p">-</span> <span class="k">if</span> <span class="vi">@registration_form</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">any?</span>
</span><span class='line'>      <span class="nt">%ul</span>
</span><span class='line'>        <span class="p">-</span> <span class="vi">@registration_form</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">full_messages</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">msg</span><span class="o">|</span>
</span><span class='line'>          <span class="nt">%li</span><span class="p">=</span> <span class="n">msg</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="s1">&#39;日付&#39;</span>
</span><span class='line'>    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">date_field</span> <span class="ss">:from_date</span>
</span><span class='line'>    <span class="nt">%span</span> 〜
</span><span class='line'>    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">date_field</span> <span class="ss">:to_date</span>
</span><span class='line'>
</span><span class='line'>    <span class="p">=</span> <span class="n">f</span><span class="o">.</span><span class="n">submit</span> <span class="s1">&#39;確定&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<h1>Translation</h1>

<h2>config/locales/ja.yml</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='yaml'><span class='line'><span class="l-Scalar-Plain">ja</span><span class="p-Indicator">:</span>
</span><span class='line'>  <span class="l-Scalar-Plain">activemodel</span><span class="p-Indicator">:</span>
</span><span class='line'>    <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">foo_day/registration_form</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">from_date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">開始日</span>
</span><span class='line'>        <span class="l-Scalar-Plain">to_date</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">終了日</span>
</span><span class='line'>    <span class="l-Scalar-Plain">errors</span><span class="p-Indicator">:</span>
</span><span class='line'>      <span class="l-Scalar-Plain">invalid_foo_day</span><span class="p-Indicator">:</span> <span class="s">&#39;%{date}</span><span class="nv"> </span><span class="s">%{message}&#39;</span>
</span><span class='line'>      <span class="l-Scalar-Plain">models</span><span class="p-Indicator">:</span>
</span><span class='line'>        <span class="l-Scalar-Plain">foo_day/registration_form</span><span class="p-Indicator">:</span>
</span><span class='line'>          <span class="l-Scalar-Plain">attributes</span><span class="p-Indicator">:</span>
</span><span class='line'>            <span class="l-Scalar-Plain">from_date</span><span class="p-Indicator">:</span>
</span><span class='line'>              <span class="l-Scalar-Plain">on_or_after</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">は %{restriction} 以降の日付を指定してください</span>
</span><span class='line'>            <span class="l-Scalar-Plain">to_date</span><span class="p-Indicator">:</span>
</span><span class='line'>              <span class="l-Scalar-Plain">on_or_after</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">は 開始日 以降の日付を指定してください</span>
</span></code></pre></td></tr></table></div></figure>


<h1>まとめ</h1>

<p>フォームとモデルが1対1で対応しないケースもたまにあるので、その時は FormObject も選択肢の一つになるかも。</p>

<h1>参考</h1>

<ul>
<li><a href="http://webuild.envato.com/blog/creating-form-objects-with-activemodel-and-virtus/">Creating Form Objects with ActiveModel and Virtus - We build Envato</a></li>
<li><a href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/">7 Patterns to Refactor Fat ActiveRecord Models - Code Climate Blog</a></li>
<li><a href="http://qiita.com/quattro_4/items/6636efbf58cca13db02a">Form Object実装メモ - Qiita</a></li>
<li><a href="http://blog.enogineer.com/2014/12/02/rails-form-object/">Rails4でFormオブジェクトを作る際に気をつける3つのポイント｜江の島エンジニアBlog</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SOFT SKILLS ソフトウェア開発者の人生マニュアル を読んだ]]></title>
    <link href="http://blog.takady.net/blog/2016/07/23/soft-skills/"/>
    <updated>2016-07-23T10:33:25+09:00</updated>
    <id>http://blog.takady.net/blog/2016/07/23/soft-skills</id>
    <content type="html"><![CDATA[<p>先月、日本語版が発売された直後に買って読んだ。</p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=takadayuichi-22&o=9&p=8&l=as1&asins=B01GDS0994&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>ソフトウェアエンジニアとして、キャリアの事から健康や心の事まで、まさに人生マニュアルといった内容で、とてもおもしろかった。<br/>
責任範囲を増やすことが自分にとってどういうメリットがあるのかとか、プロというのはどういうものかとか、なんなんだろうと思っていた事が語られていて、そういう事か〜っていう納得感が僕にはあった。<br/>
読んで1ヶ月経って、ハイライトしたところなど読みなおしていたけど、改めて良い本だと思いました。</p>

<p>何度も読みなおすのが良さそう。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[10年後の仕事のカタチ10のヒント を読んだ]]></title>
    <link href="http://blog.takady.net/blog/2016/07/23/hints-of-work-style-after-a-decade/"/>
    <updated>2016-07-23T09:14:15+09:00</updated>
    <id>http://blog.takady.net/blog/2016/07/23/hints-of-work-style-after-a-decade</id>
    <content type="html"><![CDATA[<p><a href="http://tango-ruby.hatenablog.com/entry/2015/11/04/172930">こちらのブログ記事</a> でオススメされていたので読んでみた。<br/>
対話形式になっている。ボリュームが多くないのでさくっと2時間くらいで読めて価格もお手頃。</p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=takadayuichi-22&o=9&p=8&l=as1&asins=B00HOTLXKQ&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<h1>感想</h1>

<p>印象に残ってるところ。</p>

<h2>会社以外でのプロジェクト</h2>

<ul>
<li>「自分で決める、自分でリスクを背負う」っていうのは、会社で言われてことをやるのとは全く違うんです。</li>
</ul>


<h2>東京とベトナムのピザ屋の話</h2>

<ul>
<li>東京だともうすでに美味しいピザのお店がたくさんあって競合が多いし、初期の設備投資のお金もたくさん必要。</li>
<li>ベトナムにはまだ本格的なピザを食べられるお店があまりなかったので、同じくらいの実力でもベトナムでトップになれた。</li>
<li>トップになって儲かり始めるので、もっとクオリティが良くなり、飛び抜けていく。</li>
</ul>


<h2>日本の中のものさしで測って怖がらない</h2>

<ul>
<li>イチローとか松井とか、安定した日本球界でのキャリアよりも大リーグに挑戦したのも、未知のものにトライするとワクワクするから。</li>
<li>なんとかなる。</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[10年戦えるデータ分析入門 SQLを武器にデータ活用時代を生き抜く を読んだ]]></title>
    <link href="http://blog.takady.net/blog/2016/05/22/introduction-to-data-analysis-book/"/>
    <updated>2016-05-22T10:38:56+09:00</updated>
    <id>http://blog.takady.net/blog/2016/05/22/introduction-to-data-analysis-book</id>
    <content type="html"><![CDATA[<p>読んだ。</p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=takadayuichi-22&o=9&p=8&l=as1&asins=4797376279&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>最近またデータ活用的なところをやる機会が来るかもなので、今ってその辺どんな感じなんだろうというのを知りたくて本書を手にとった。ボリューム自体は重くなく、数時間で読めた。</p>

<h1>感想</h1>

<p>第1部の SQL 初級入門な章は流し読みした。</p>

<p>第2部以降、下記のような話が網羅されていて参考になった。</p>

<ul>
<li>データソース層、DWH層、データマート層の3層構造</li>
<li>オンプレミスとクラウドサービス利用のトレードオフ</li>
<li>ディメンションテーブル（スタースキーマ）</li>
<li>ETL と ELT</li>
<li>DWH 向けデータベース製品のそれぞれの特長の説明（BigQueryやHadoop含む）</li>
<li>データ構築のバッチは処理の粒度を細かくして冪等に作ろうって話</li>
<li>差分更新・全件更新の話</li>
</ul>


<p>あとテストの話も書いてはあるが、SQLが正常に動くことや件数が正しいことのテストだった。<br/>
実際にデータの内容が正しいかのテストがデータ基盤のテストとしては最も重要だけど方法として確立されたものは聞いたことがないので、その辺についてなにか書いてくれてることを期待してた。この本に載っていないということは、まだそういうテスト手法は出てきてないのかもしれない。</p>

<h1>その他</h1>

<p>2011年から2013年くらいまでひたすらバッチで Hadoop にデータを入れてそれを HiveQL で集計・抽出という業務をやっていた時期があって、その時に感じていたことやみんなで考えていたような事が書かれていたりして懐かしく思ったし、当時の自分たちの方法が肯定される記述も多くて良かったと思った。<br/>
当時はこういう大規模データ運用現場に関する知見があまり出回ってなかった気がする。（Hadoop とかビックデータという言葉はやたらバズっていたが。<br/>
あの時この本読んでたらなーとも思った。</p>

<p>データ分析基盤を作っている人やこれから作っていこうとしている人にとって本書はとても良いものだとおもいました。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[nexus5 の画面が割れたので自分で交換した]]></title>
    <link href="http://blog.takady.net/blog/2016/05/15/nexus5-screen-replacement/"/>
    <updated>2016-05-15T21:56:33+09:00</updated>
    <id>http://blog.takady.net/blog/2016/05/15/nexus5-screen-replacement</id>
    <content type="html"><![CDATA[<p>3日前に nexus5 を落としてしまって画面が思いっきり割れてしまった。</p>

<p><img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5931_1024.jpg" alt="" /></p>

<p>端末の画面を割ってしまったのは初めてだったし、まだ買って半年だったのでとても残念な気持ちになった。</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">はじめてスマホの仮面が割れたバキバキに</p>&mdash; Yuichi Takada (@takady7) <a href="https://twitter.com/takady7/status/731131513887031297">2016年5月13日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">最低の気分なんですけど！！！！！1</p>&mdash; Yuichi Takada (@takady7) <a href="https://twitter.com/takady7/status/731131644845817858">2016年5月13日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>




<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">やばい、ほんと、ありえない</p>&mdash; Yuichi Takada (@takady7) <a href="https://twitter.com/takady7/status/731132397010345986">2016年5月13日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>とにかく落ち着いて「nexus5 画面 交換」とかでググッて修理についての情報を集めた。<br/>
どうやら修理に出すと2万円超えみたいだ。高い…。<br/>
とはいえ、この割れた画面を見るたびにテンションが下がってどうしようもない。</p>

<p>そんな中、自力で直してたという記事を発見。<br/>
<a href="http://www.blogershin.link/archives/242">Nexus 5 ガラス割れを自力で交換修理する件</a></p>

<p>用意するものは、Amazon で売ってるこの交換用ディスプレイと必要な工具のセット。13,500円。<br/>
結構高いけどこれが画面を交換する最安の方法のようなので、こちらを購入した。</p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=takadayuichi-22&o=9&p=8&l=as1&asins=B00V7VB8U2&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<p>実際の分解・交換にはYoutube のこちらの動画も参考にした。</p>

<ul>
<li>Nexus 5 Screen Replacement Part 1 How To Change</li>
</ul>


<iframe width="560" height="315" src="https://www.youtube.com/embed/nVAtEyRBny0" frameborder="0" allowfullscreen></iframe>


<p>Amazon のレビューのコメントでは「30分くらいで意外と簡単にできました！」みたいなコメントがあったけど、やってみると1時間以上かかったし、両面テープでくっついている箇所を剥がしたりするのに非常に神経を使った。</p>

<p>交換の様子。</p>

<p><img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5922_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5923_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5924_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5925_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5926_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5927_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5928_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5930_1024.jpg" alt="" /><br/>
<img src="http://blog.takady.net/images/2016-05-15-nexus5-screen-replacement/thumb_IMG_5932_1024.jpg" alt="" /></p>

<p>最後の最後に背面カバーをはめる時に、バッテリー横の線が一本挟まって切れてしまって、絶望したけど電源を入れて確認しても何も問題無いので、一旦様子見。</p>

<p>ということで、交換は無事に成功！</p>

<blockquote class="twitter-tweet" data-lang="ja"><p lang="ja" dir="ltr">nexus5 の画面取り替えに成功した！</p>&mdash; Yuichi Takada (@takady7) <a href="https://twitter.com/takady7/status/731827195639783424">2016年5月15日</a></blockquote>


<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>


<h2>注意</h2>

<p><strong><em>自力での交換は失敗の可能性があったり、メーカー保証の対象外となるなどするので、くれぐれも自己責任でお願いします。</em></strong></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[自分の開発スピードを上げるには]]></title>
    <link href="http://blog.takady.net/blog/2016/05/02/more-productive/"/>
    <updated>2016-05-02T01:10:20+09:00</updated>
    <id>http://blog.takady.net/blog/2016/05/02/more-productive</id>
    <content type="html"><![CDATA[<p>新しい機能なりサービスを作った後に振り返ってみると、もっと上手くやれた気がするなーって思う。<br/>
もっと早く、質の良いものを作るにはどうすれば良いのか。<br/>
そもそも開発とひとことで言っても、細かくどういうポイントを気にしておく必要があるか、そしてそのどこを改善できそうか考えてみた。</p>

<h1>仕様決め</h1>

<ul>
<li><p>それを作る理由について納得しているか</p>

<ul>
<li>納得してないとか、そもそも背景を理解してない状態で仕様決めに入るのはかなり厳しい。</li>
<li>システムとしてだけでなくて、ビジネス的にそれってどうなんですかっていうのは質問して納得しておきたい。

<ul>
<li>とはいえ腰の重い開発者にはなりたくないので柔軟に。</li>
</ul>
</li>
</ul>
</li>
<li><p>解決したい課題が明確になっているか</p>

<ul>
<li>最初は何か課題があるはずだけど、それをすっ飛ばして具体的な解決方法から話が始まる事がわりとある。

<ul>
<li>実は別の方法が良かったりするかもしれないので、解決したい課題は何なのか明確にしておきたい。</li>
</ul>
</li>
</ul>
</li>
<li><p>誰が最終的に決定するのか</p>

<ul>
<li>発散はしても良いけど最後決める人がいないとなかなか固まらなくてやきもきする。</li>
<li>特に関係者が増えると本当に決まらないので、誰が決める人なのかってのはちゃんと認識合わせておきたい。</li>
</ul>
</li>
<li><p>優先順位の高いものはどれか</p>

<ul>
<li>規模が小さければ一気に作っちゃうのだけど、規模が大きい場合は一気に全部作ろうとしないで重要なものから作って出来たところから出していった方が良い。</li>
<li>優先順位の低いものは本当に必要かもわかってなかったりするので最初から詳細まで詰めなくても良い。</li>
<li>いつまでにどこまで出したいかは確認しておく。</li>
</ul>
</li>
<li><p>そもそも現状の仕様がどうなっているかをシステムレベルで把握しているか</p>

<ul>
<li>そもそもの前提が間違っていたりすると議論が全くの無駄になることも。</li>
<li>把握してない状態で課題に対しての解決案を提示するのは結構難しい。</li>
</ul>
</li>
</ul>


<h1>設計</h1>

<ul>
<li><p>既存に引っ張られすぎていないか</p>

<ul>
<li>既存がこうだからそれを踏襲していく形で考えてしまいがちだが、そこに縛られすぎずに本来どうあるべきかを考えてみる。

<ul>
<li>時間的制約などにより結果的に理想の形を取れなくても、チーム内で理想の形は共有しておきたい。</li>
</ul>
</li>
</ul>
</li>
<li><p>それはそのモデルやサービスの責務か</p>

<ul>
<li>責務を超えた事をやらせていたり、隠蔽しておきたい知識・概念がその範囲外に流出してしまうのは避けたい。

<ul>
<li>ここが自分にとっては結構難しくて、もっと上手くやりたいところ。

<ul>
<li>あしがかりになりそうな DDD の知識を学びたい。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>なぜその名前付けをしたのかを説明できるか</p>

<ul>
<li>名前重要ってのは最近本当に感じてて、でもいつも結構悩むんだけど、これは何かのサインなのか。</li>
</ul>
</li>
</ul>


<h1>実装</h1>

<ul>
<li><p>集中できているか</p>

<ul>
<li>とにかく実装は集中してやっているかどうかで掛かる時間が何倍も変わるので、自分が集中している状態にい続けられるように気を遣う。</li>
<li>詳細な実装方法で迷ったりする時は実際に書いて見比べる方がイメージしやすくて、書いたコードを見てみると意外と悪くないねという感じになる事も多い。</li>
</ul>
</li>
<li><p>テストコードを書く事に時間がかかってないか</p>

<ul>
<li>プロダクションコード書くよりテストコード書く時間の方が長くなりがち。

<ul>
<li>ここはもう少し改善できそう。</li>
<li>テストについては何か一冊本でも読んで学ぶと良さそう。</li>
</ul>
</li>
</ul>
</li>
<li><p>コードレビューしやすい PR になっているか</p>

<ul>
<li>レビュアーが気になりそうなポイントは、先に PR の Description に書いておく。

<ul>
<li>ただ、Description が長過ぎると重い感じになるので、コードやコミットメッセージなどで明らかにわかることは書かないことにしてる。</li>
</ul>
</li>
<li>1つの PR が大きくなり過ぎたら分けられないか考える。

<ul>
<li>1つの PR でだいたい変更が 200行くらいまでにした方が見やすくてレビュアーの負担も少ないと思う。</li>
</ul>
</li>
<li>意味の単位でコミット分ける。

<ul>
<li>コミット単位で見てくれる人もいるので、その人に意図が伝わるように書くと、将来 commit log 見直した時にも意図が分かりやすかったりする。

<ul>
<li>1行目: 要約</li>
<li>2行目: 空行</li>
<li>3行目: 理由含めた説明</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>リリースタイミングを考えられているか</p>

<ul>
<li>なるべく出来たものから出していきたい。</li>
<li>db migration があるものはタイミング気をつける。</li>
</ul>
</li>
</ul>


<h1>検証</h1>

<ul>
<li>検証環境特有の問題を取り除けているか

<ul>
<li>大体時間が掛かるのは、実際に検証したい箇所ではなくて、何か設定の差異等によるつまらない問題である事が多い。

<ul>
<li>特に他チームのサービスとのインターフェース部分は、開発環境では普段モックしていたりするので、そういう問題がよく起きがち。

<ul>
<li>そういう問題は起きないように改善するのはもちろんだし、認識してるのであれば事前に取り除いておきたい。</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>


<h1>まとめ</h1>

<p>改めてまとめてみると、改善できそうなところが見えてきた気がする。<br/>
DDD の本とテストの本を読まねば。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Android Studio で emacs キーバインドでコードを書く]]></title>
    <link href="http://blog.takady.net/blog/2016/01/27/android-studio-with-emacs-keybinds/"/>
    <updated>2016-01-27T23:15:54+09:00</updated>
    <id>http://blog.takady.net/blog/2016/01/27/android-studio-with-emacs-keybinds</id>
    <content type="html"><![CDATA[<p>Android Studio でコードを書こうと思ったのだが、キーバインドが全然しっくり来なくて嫌になりそうだったのでキーバインドの設定をはじめにした。<br/>
Android Studio には、Emacs キーバインドの設定が元々用意されているのでそれを使った。<br/>
普段は Karabinar を使って Emacs キーバインドにしているからそれで良いかとも思ったけど、IDE 側のキーバインドと競合したりしてつらいので Android Studio の時は Karabinar が OFF になるようにして Android Studio のキーバインド設定を使うことにした。</p>

<p>まず Karabinar の Emacs キーバインドの設定を Android Studio の時は無効になるようにする。<br/>
<a href="https://github.com/tekezo/Karabiner/blob/version_10.15.0/src/core/server/Resources/replacementdef.xml#L104-L114">ここの設定</a> を private.xml でこんな感じに上書きした。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'>  <span class="nt">&lt;replacementdef&gt;</span>
</span><span class='line'>    <span class="nt">&lt;replacementname&gt;</span>EMACS_MODE_IGNORE_APPS<span class="nt">&lt;/replacementname&gt;</span>
</span><span class='line'>    <span class="nt">&lt;replacementvalue&gt;</span>
</span><span class='line'>      EMACS,
</span><span class='line'>      REMOTEDESKTOPCONNECTION,
</span><span class='line'>      TERMINAL,
</span><span class='line'>      VI,
</span><span class='line'>      VIRTUALMACHINE,
</span><span class='line'>      X11,
</span><span class='line'>      ANDROID_STUDIO,
</span><span class='line'>    <span class="nt">&lt;/replacementvalue&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/replacementdef&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>書き換えたら Karabinar の Preference で Reload XML すれば設定が反映される。<br/>
次に Android Studio の Preference > Keymap で <code>Keymaps: Emacs</code> に設定すれば OK。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[2015年まとめ]]></title>
    <link href="http://blog.takady.net/blog/2015/12/31/2015-summary/"/>
    <updated>2015-12-31T19:50:01+09:00</updated>
    <id>http://blog.takady.net/blog/2015/12/31/2015-summary</id>
    <content type="html"><![CDATA[<p>簡単に振り返っとこう。</p>

<h1>転職</h1>

<p>5 月に転職した。</p>

<ul>
<li><a href="http://blog.takady.net/blog/2015/07/05/join-a-new-company-and-past-a-month/">転職して１ヶ月経った | Yuichi Takada</a></li>
</ul>


<p>新しい環境というのが一番自分を成長させてくれると思うし、今回もそう思った。<br/>
インフラ環境など含め前職と違うところも多く、しかし本質的な事に集中できる環境であり逆に自分に言い訳出来なくて厳しい感じになったりもしたけど、10月くらいに自分の中でそれは乗り越えた気がする。</p>

<h1>結婚</h1>

<p>5 月に結婚した。<br/>
健康的で人間的な生活を送れるようになったし、楽しく毎日を送れている。<br/>
最近は寝る前に二人で晩酌をするので、そのための美味しい日本酒を探すのも楽しい。</p>

<h1>isucon</h1>

<p>今年は初めて isucon にチャレンジした。</p>

<ul>
<li><a href="http://blog.takady.net/blog/2015/09/29/isucon5-qualifier/">#isucon 5 予選で惨敗してきました | Yuichi Takada</a></li>
</ul>


<p>予選当日もかなり楽しかったけど、それ以上に予選前に勉強したカーネルチューニングや DB の index やメトリクスの取り方などはエンジニアとして身につけておくべき重要な事だと思っていたので、それを勉強するいい機会になって本当に良かった。<br/>
でも決勝に進出したかった。</p>

<h1>発表</h1>

<p>社内 LT 大会で毎月発表したのと、社外では一つ発表した。</p>

<ul>
<li><a href="https://speakerdeck.com/takady/isucon5-qualifier">isucon5 予選をどう惨敗したか / isucon5 qualifier // Speaker Deck</a></li>
</ul>


<h1>github</h1>

<p>業務以外でコード書く事が少なかったかな…。特に年末はその余裕が無かった。残念である。<br/>
個人的に作っている web サービスを公開したかったけど、年内に間に合わなかった。<br/>
来年早々に出したい。ひっそりと。</p>

<h2>sign in した状態</h2>

<p><img src="http://blog.takady.net/images/2015-12-31-2015-summary/github_contribution_private.png" alt="" /></p>

<h2>sign out した状態</h2>

<p><img src="http://blog.takady.net/images/2015-12-31-2015-summary/github_contribution_public.png" alt="" /></p>

<h1>読書</h1>

<p>読んだ書籍。</p>

<ul>
<li><a href="http://www.amazon.co.jp/gp/product/4774150207/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4774150207&amp;linkCode=as2&amp;tag=takadayuichi-22">Webエンジニアのための データベース技術[実践]入門 (Software Design plus)</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4774171972/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4774171972&amp;linkCode=as2&amp;tag=takadayuichi-22">理論から学ぶデータベース実践入門 ~リレーショナルモデルによる効率的なSQL (WEB+DB PRESS plus)</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4774173010/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4774173010&amp;linkCode=as2&amp;tag=takadayuichi-22">SQL実践入門──高速でわかりやすいクエリの書き方 (WEB+DB PRESS plus)</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4274067939/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4274067939&amp;linkCode=as2&amp;tag=takadayuichi-22">情熱プログラマー ソフトウェア開発者の幸せな生き方</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4797311126/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4797311126&amp;linkCode=as2&amp;tag=takadayuichi-22">オブジェクト指向における再利用のためのデザインパターン</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/B01626P712/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=B01626P712&amp;linkCode=as2&amp;tag=takadayuichi-22">エンジニアとして世界の最前線で働く選択肢　～渡米・面接・転職・キャリアアップ・レイオフ対策までの実践ガイド</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4413090101/ref=as_li_qf_sp_asin_il_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4413090101&amp;linkCode=as2&amp;tag=takadayuichi-22">自分の中に毒を持て―あなたは“常識人間&#8221;を捨てられるか (青春文庫)</a></li>
<li><a href="http://www.amazon.co.jp/gp/product/4167502100/ref=as_li_qf_sp_asin_tl?ie=UTF8&amp;camp=247&amp;creative=1211&amp;creativeASIN=4167502100&amp;linkCode=as2&amp;tag=takadayuichi-22">走ることについて語るときに僕の語ること (文春文庫)</a></li>
</ul>


<h1>android</h1>

<p>12 年くらいソフトバンクユーザーだったけど先日ついに MNP して BIC SIM(IIJmio) に変えた。<br/>
そのタイミングで iPhone5 から Nexus5 に変わり、android ユーザーになった。<br/>
まだ慣れない。<br/>
Android アプリでも作ってみようかな。</p>

<h1>まとめ</h1>

<p>転職・結婚・引越しというイベントが 5月にいっぺんに来たのでその印象が強すぎてそれ以前の時期の事があんまり思い出せない。<br/>
総じて色々あった年だったなという印象。<br/>
あんまり自分の事に満足出来ないタイプなので、すごく良かったとも思わない。<br/>
2 年前まで SQL と Shell スクリプトのバッチしか書いてなくて危機を感じてた頃に比べて web エンジニアらしき者になれてきた気はする。</p>

<h1>来年やること</h1>

<ul>
<li>英語を勉強する</li>
<li>Go もしくは何か Ruby 以外のプログラミング言語習得する</li>
<li>個人的に作った web サービスの運営をする</li>
<li>美味しいコーヒーを淹れられるようになる</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Raspberry Pi と温度センサーで自宅の温度を可視化]]></title>
    <link href="http://blog.takady.net/blog/2015/12/18/raspberry-pi-with-adt7410/"/>
    <updated>2015-12-18T00:46:37+09:00</updated>
    <id>http://blog.takady.net/blog/2015/12/18/raspberry-pi-with-adt7410</id>
    <content type="html"><![CDATA[<p><strong><em>この記事は <a href="http://qiita.com/advent-calendar/2015/sansan">Sansan Advent Calendar 2015</a> の 18日目の記事です。</em></strong><br/>
<br /></p>

<p>Raspberry Pi と ADT7410 温度センサーで自宅の温度を測り、 <a href="https://github.com/focuslight/focuslight">focusligt</a> でグラフにした。<br/>
動機は 2年くらい前に買ったまま放置してた Raspberry Pi に備わっている GPIO のことがずっと気になっていたから。</p>

<h1>用意したもの</h1>

<ul>
<li>Raspberry Pi Model B</li>
<li><a href="http://akizukidenshi.com/catalog/g/gM-06675/">ADT7410使用 高精度・高分解能 I2C・16Bit 温度センサモジュール</a></li>
<li><a href="http://akizukidenshi.com/catalog/g/gP-05294/">ブレッドボード BB-801</a></li>
<li><a href="http://akizukidenshi.com/catalog/g/gC-08932/">ブレッドボード・ジャンパーコード（オス-メス） 15cm（黒）</a> x 4本</li>
<li><a rel="nofollow" href="http://www.amazon.co.jp/gp/product/B0016VDGIA/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B0016VDGIA&linkCode=as2&tag=takadayuichi-22">goot 一般電気用はんだこて KS-30R</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=takadayuichi-22&l=as2&o=9&a=B0016VDGIA" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
<li><a rel="nofollow" href="http://www.amazon.co.jp/gp/product/B0029LGAJI/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=B0029LGAJI&linkCode=as2&tag=takadayuichi-22">goot 高密度集積基板用はんだ SD-60</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=takadayuichi-22&l=as2&o=9&a=B0029LGAJI" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /></li>
</ul>


<h1>工程</h1>

<p>まず Raspberry Pi の初期設定をした。<br/>
詳細は割愛するが、RASPBIAN JESSIE の最新版を <a href="https://www.raspberrypi.org/downloads/raspbian/">Download Raspbian for Raspberry Pi</a> からダウンロードして SD に焼き、本体を起動して設定。<br/>
<a href="https://www.raspberrypi.org/documentation/installation/installing-images/README.md">公式のインストールガイド</a>を参考にすれば問題ないと思われる。</p>

<p>次に、温度センサーをブレッドボードにつなぐために、付属のピンヘッダをはんだ付けする。<br/>
小さいので、ブリッジしないように注意する。(15年ぶりくらいにやったけど意外と出来た)</p>

<p><img src="http://blog.takady.net/images/2015-12-18-raspberry-pi-with-adt7410/IMG_5876.JPG" alt="" /></p>

<p><img src="http://blog.takady.net/images/2015-12-18-raspberry-pi-with-adt7410/IMG_5877.JPG" alt="" /></p>

<p>温度センサーを下記のようにブリッジボード経由で GND, VDD, SDA, SCL につなぐ。<br/>
どのピンが何なのかは <a href="https://www.raspberrypi.org/documentation/usage/gpio/">こちら</a>で確認。</p>

<p><img src="http://blog.takady.net/images/2015-12-18-raspberry-pi-with-adt7410/ADT7410_raspi_breadboard.png" alt="" /></p>

<p><img src="http://blog.takady.net/images/2015-12-18-raspberry-pi-with-adt7410/IMG_5878.JPG" alt="" /></p>

<p>そして <code>/etc/modules</code> に <code>i2c-bcm2708</code> を追記する。</p>

<pre><code>pi@raspberrypi:~ $ cat /etc/modules
# /etc/modules: kernel modules to load at boot time.
#
# This file contains the names of kernel modules that should be loaded
# at boot time, one per line. Lines beginning with "#" are ignored.

i2c-dev
i2c-bcm2708
</code></pre>

<p><code>/boot/config.txt</code> を編集。</p>

<pre><code>pi@raspberrypi:~ $ sudo vim /boot/config.txt

device_tree=bcm2708-rpi-b.dtb
device_tree_param=i2c1=on
device_tree_param=spi=on
</code></pre>

<p>再起動。</p>

<pre><code>pi@raspberrypi:~ $ sudo reboot
</code></pre>

<p>これでデバイスとつながった。</p>

<pre><code>pi@raspberrypi:~ $ sudo /usr/sbin/i2cdetect -y 1
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f
00:          -- -- -- -- -- -- -- -- -- -- -- -- --
10: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
20: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
30: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
40: -- -- -- -- -- -- -- -- 48 -- -- -- -- -- -- --
50: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
60: -- -- -- -- -- -- -- -- -- -- -- -- -- -- -- --
70: -- -- -- -- -- -- -- --
</code></pre>

<p>温度が取れているようだ。</p>

<pre><code>pi@raspberrypi:~ $ sudo i2cdump -y 1 0x48
No size specified (using byte-data access)
     0  1  2  3  4  5  6  7  8  9  a  b  c  d  e  f    0123456789abcdef
00: 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c    ????????????????
10: 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c    ????????????????
20: 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 0c 00    ???????????????.
30: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
40: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
50: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
60: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
70: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
80: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
90: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
a0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
b0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
c0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
d0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
e0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
f0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00    ................
</code></pre>

<p>あとは、 ruby の <code>i2c-devices</code> という gem を利用して温度を取得するスクリプトを用意する。<br/>
ちなみに ruby はデフォルトで入っている。</p>

<pre><code>pi@raspberrypi:~ $ ruby -v
ruby 2.1.5p273 (2014-11-13) [arm-linux-gnueabihf]

pi@raspberrypi:~ $ sudo gem install i2c
pi@raspberrypi:~ $ sudo gem install i2c-devices

pi@raspberrypi:~ $ vim adt7410.rb
</code></pre>

<p>下記のような簡単なスクリプト。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1">#!/usr/bin/env ruby</span>
</span><span class='line'>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;i2c/device/adt7410&#39;</span>
</span><span class='line'><span class="nb">require</span> <span class="s1">&#39;i2c/driver/i2c-dev&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">device</span> <span class="o">=</span> <span class="no">I2CDevice</span><span class="o">::</span><span class="no">ADT7410</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">driver</span><span class="p">:</span> <span class="no">I2CDevice</span><span class="o">::</span><span class="no">Driver</span><span class="o">::</span><span class="no">I2CDev</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s1">&#39;/dev/i2c-1&#39;</span><span class="p">),</span> <span class="ss">address</span><span class="p">:</span> <span class="mh">0x48</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="nb">puts</span> <span class="n">device</span><span class="o">.</span><span class="n">calculate_temperature</span><span class="o">.</span><span class="n">round</span>
</span></code></pre></td></tr></table></div></figure>


<p>実行結果。</p>

<pre><code>pi@raspberrypi:~ $ ruby adt7410.rb
26
</code></pre>

<p>この数値を 5分おきに focusligt に送るように crontab に設定する。</p>

<pre><code>pi@raspberrypi:~ $ crontab -l
*/5 * * * * curl -d number=`ruby adt7410.rb` http://localhost/api/myhome/living/temperature &gt;&gt; /home/pi/cron.log 2&gt;&amp;1
</code></pre>

<p>ブラウザから見てみると。</p>

<p><img src="http://blog.takady.net/images/2015-12-18-raspberry-pi-with-adt7410/focuslight.png" alt="" /></p>

<p>ちゃんと取れてる！</p>

<h1>まとめ</h1>

<p>Raspberry Pi と adt7410 で室内の温度を測ってグラフにした。<br/>
これで外出先から自宅の温度が確認できるようになった。<br/>
IRkit と組み合わせることで、外出先からもエアコンの消し忘れに気づき、電源を OFF にすることができる。<br/>
ハードウェアを使って何かするというの、かなりおもしろいものだなと思った。これからも電子工作してきたい。</p>

<h1>参考</h1>

<ul>
<li><a href="http://www.myu.ac.jp/~xkozima/lab/raspTutorial1.html">こじ研（Raspberry Pi）</a></li>
<li><a href="https://www.raspberrypi.org/documentation/usage/gpio/">GPIO: Raspberry Pi Models A and B - Raspberry Pi Documentation</a></li>
<li><a href="https://www.youtube.com/watch?v=Dz8hQGo3YwQ&amp;feature=youtu.be">ウェッブエンジニアのローレベルプログラミング / cho45 - YouTube</a></li>
<li><a href="https://github.com/cho45/ruby-i2c-devices">cho45/ruby-i2c-devices</a></li>
<li><a href="https://github.com/MozOpenHard/examples/blob/master/i2c-ADT7410/ADT7410.fzz">examples/ADT7410.fzz at master · MozOpenHard/examples</a></li>
<li><a href="http://www.e-ark.jp/2013/02/12/%E9%9B%BB%E5%AD%90%E5%9B%9E%E8%B7%AF%E8%A8%AD%E8%A8%88%E3%83%84%E3%83%BC%E3%83%AB-fritzing-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F/">電子回路設計ツール Fritzing を使ってみた | ε-ARK Project</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rails で /users/:id ではなく /:username な routing にする方法]]></title>
    <link href="http://blog.takady.net/blog/2015/11/29/rails-routing-with-username-instead-of-id/"/>
    <updated>2015-11-29T23:06:56+09:00</updated>
    <id>http://blog.takady.net/blog/2015/11/29/rails-routing-with-username-instead-of-id</id>
    <content type="html"><![CDATA[<p>rails で普通に scaffold すると id が URL に入って <code>example.com/users/:id</code> となる。<br/>
これを <code>twitter.com/takady7</code> とか <code>github.com/takady</code> みたいにしたい時がある。<br/>
実現には 2 通りの方法があると思われる。</p>

<h1>to_param を使う方法</h1>

<p>activerecord に <a href="http://railsdoc.com/references/to_param">to_param</a> というメソッドがあって、これを使うと URL の :id の部分に id 以外を指定できるようになる。</p>

<h2>user.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">User</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
</span><span class='line'>  <span class="n">validates_presence_of</span> <span class="ss">:username</span>
</span><span class='line'>  <span class="n">validates_uniqueness_of</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">case_sensitive</span><span class="p">:</span> <span class="kp">false</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">def</span> <span class="nf">to_param</span>
</span><span class='line'>    <span class="n">username</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>users_controller.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>routes.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>$ rake routes
    Prefix Verb   URI Pattern                        Controller#Action
 edit_user GET    /:id/edit(.:format)                users#edit
      user GET    /:id(.:format)                     users#show
           PATCH  /:id(.:format)                     users#update
           PUT    /:id(.:format)                     users#update
           DELETE /:id(.:format)                     users#destroy
</code></pre>

<h1>routing で param を設定する方法</h1>

<p>User クラスに to_param を定義せずに、 routes.rb で設定する方法。<br/>
<code>params[:username]</code> というふうに渡ってくるので、こちらの方が素直な気がして個人的にはこちらを使いたい。</p>

<h2>users_controller.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">class</span> <span class="nc">UsersController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
</span><span class='line'>  <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>    <span class="vi">@user</span> <span class="o">=</span> <span class="no">User</span><span class="o">.</span><span class="n">find_by</span><span class="p">(</span><span class="ss">username</span><span class="p">:</span> <span class="n">params</span><span class="o">[</span><span class="ss">:username</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<h2>routes.rb</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">Rails</span><span class="o">.</span><span class="n">application</span><span class="o">.</span><span class="n">routes</span><span class="o">.</span><span class="n">draw</span> <span class="k">do</span>
</span><span class='line'>  <span class="n">resources</span> <span class="ss">:users</span><span class="p">,</span> <span class="ss">param</span><span class="p">:</span> <span class="ss">:username</span><span class="p">,</span> <span class="ss">path</span><span class="p">:</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="ss">only</span><span class="p">:</span> <span class="o">[</span><span class="ss">:show</span><span class="p">,</span> <span class="ss">:edit</span><span class="p">,</span> <span class="ss">:update</span><span class="p">,</span> <span class="ss">:destroy</span><span class="o">]</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<pre><code>$ rake routes
    Prefix Verb   URI Pattern                        Controller#Action
 edit_user GET    /:username/edit(.:format)          users#edit
      user GET    /:username(.:format)               users#show
           PATCH  /:username(.:format)               users#update
           PUT    /:username(.:format)               users#update
           DELETE /:username(.:format)               users#destroy
</code></pre>

<h1>参考</h1>

<ul>
<li><a href="http://stackoverflow.com/questions/7735315/rails-route-to-username-instead-of-id">ruby - Rails route to username instead of id - Stack Overflow</a></li>
<li><a href="http://railsdoc.com/references/to_param">to_param - リファレンス - - Railsドキュメント</a></li>
<li><a href="http://tnakamura.hatenablog.com/entry/2014/01/31/185214">Github みたいにパスの最初のセグメントでユーザー名を使う方法 - present</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[オブジェクト指向における再利用のためのデザインパターン を読んだ]]></title>
    <link href="http://blog.takady.net/blog/2015/11/04/gof-design-pattern/"/>
    <updated>2015-11-04T20:45:35+09:00</updated>
    <id>http://blog.takady.net/blog/2015/11/04/gof-design-pattern</id>
    <content type="html"><![CDATA[<p>いわゆる GoF 本を読んだ。</p>

<p><br /></p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=takadayuichi-22&o=9&p=8&l=as1&asins=4797311126&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>


<h1>動機</h1>

<p>こういう設計に関する本は今まで読んだことがなくて、なんとなくそういうことは本で勉強するより実践から身につけるものなんだろうという考えがあったんだけど、チームリーダーからそういう本も読んでみたらいいよと言われたこともあり、どうせ読むなら一番ベタなやつをということでこの本を選んだ。</p>

<h1>感想</h1>

<p>書いてあるパターンには、よく知っているものから、よくわからないものまであった。<br/>
今までなんとなく書いていた書き方に、oo パターンという名前が付いたような感じ。<br/>
ただ、違いがいまいち理解出来ないものもあったりして、引き続き勉強しないとなと思った。</p>

<p>役に立ちそうなところとか、良かったと思ったことはこの辺だろうか。</p>

<ul>
<li><p>共通の設計用語が身につく</p>

<ul>
<li>oo パターンという名前によって伝えられるので、他の人にも伝えやすい。</li>
<li>他の開発者とのコミュニケーションの助けになると思う。</li>
</ul>
</li>
<li><p>先人の知恵を借りられる</p>

<ul>
<li>実践の中でぼんやりと見えてくるであろう良い設計というものが、この本を読むことで学べた。かもしれない。</li>
</ul>
</li>
<li><p>リファクタリングの道すじを考えやすくなる</p>

<ul>
<li>そもそも最初からデザインパターンを適用して設計すれば、リファクタリングの必要性すら減るのかもしれない。</li>
<li>既存のコードに対してリファクタリングをする際には、デザインパターンを適用出来ないか検討してみたい。拡張・保守しやすいものにするために。</li>
<li>もちろんそれを振りかざしてはいけないと思う。</li>
</ul>
</li>
</ul>


<p>実際に開発をするときには rails などのフレームワークを使うことがほぼ 100% なわけで、そのフレームワークが自然に求める書き方をするべきだと思っている。そうしないとそのフレームワークを選ぶ意味が無いから。同じように言語自体の特性というものもあるだろう。<br/>
言語、フレームワークとデザインパターンを上手く使いこなしていきたいし、アイデアの引き出しを増やす意味でもこの本を読んだ意味があったと思う。</p>

<h1>その他</h1>

<p>サンプルが C++ なのがつらくて、Ruby で書いてあるものを探したら <a rel="nofollow" href="http://www.amazon.co.jp/gp/product/4894712857/ref=as_li_qf_sp_asin_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4894712857&linkCode=as2&tag=takadayuichi-22">Rubyによるデザインパターン</a><img src="http://ir-jp.amazon-adsystem.com/e/ir?t=takadayuichi-22&l=as2&o=9&a=4894712857" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" /> という本が見つかったが、残念ながら絶版になっていた。<br/>
web 上の記事としては <a href="http://morizyun.github.io/blog/ruby-design-pattern-matome-mokuzi/">Ruby 2.0.0で学ぶ、14個のデザインパターンを作りました[GoF][Design Pattern] - 酒と泪とRubyとRailsと</a> がかなり参考になった。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[情熱プログラマー を読んだ]]></title>
    <link href="http://blog.takady.net/blog/2015/10/11/the-passionate-programmer/"/>
    <updated>2015-10-11T21:01:24+09:00</updated>
    <id>http://blog.takady.net/blog/2015/10/11/the-passionate-programmer</id>
    <content type="html"><![CDATA[<p>良い本だった。<br/>
さすが半谷さんオススメ本。<br/>
<br /></p>

<ul>
<li><p>4: 一番の下手くそでいよう</p></li>
<li><p>13: 師匠を探す<br/>
手本となる人物の特長10個を重要度で並べて、その10項目それぞれに対して、師匠は自分に10点中何点をつけるか考える。重要度から自分の評価点数を引いた値が高いものから順に、今すぐ始められる具体的なリストをまとめていく。</p></li>
<li><p>15: 一に練習、ニに練習</p></li>
<li><p>27: 保守作業の真価を知る<br/>
測定、改善、測定。そのうちゲームみたいに楽しくなってくるだろう。</p></li>
<li><p>38: 世界を変えよう<br/>
職場で自分が目撃した聖戦をリストにまとめる。まるで使命を帯びているように見えた人はいなかっただろうか。</p></li>
<li><p>39: 業界で名前を売ろう<br/>
ブログを始めよう。10分か20分で書けそうな話題で。</p></li>
<li><p>48: 市場に気を配る<br/>
今後1年間、アルファギークの仲間入りをすべく努力してみよう。あるいは、少なくともアルファギークの友達を一人作ろう。</p></li>
</ul>


<p>意外とキャリア戦略的な要素も入ってた。<br/>
あと、米国とインドの話と、Jave と .NET の話がちょいちょい出てきたのが印象に残った。<br/>
たまに読み返すのが良さそう。<br/>
<br /></p>

<iframe src="http://rcm-fe.amazon-adsystem.com/e/cm?t=takadayuichi-22&o=9&p=8&l=as1&asins=4274067939&ref=qf_sp_asin_til&fc1=000000&IS2=1&lt1=_blank&m=amazon&lc1=0000FF&bc1=000000&bg1=FFFFFF&f=ifr" style="width:120px;height:240px;" scrolling="no" marginwidth="0" marginheight="0" frameborder="0"></iframe>

]]></content>
  </entry>
  
</feed>
